---
title: "1 - Data Preparation"
description: |
  Preparation of the pre-cleaned and speaker/genre-tagged play text.
author:
  - name: "Lars Hinrichs"
    url: https://larshinrichs.site
    affiliation: "The University of Texas at Austin"
    affiliation_url: https://liberalarts.utexas.edu/english
date: 10-17-2020
output:
  distill::distill_article:
    self_contained: false
---

```{r setup}
if (!require(pacman)) install.packages("pacman")
library(pacman)
p_load(rio, tidyverse, tidytext, knitr, flextable,
       kableExtra,
       textreadr, janitor)
opts_chunk$set(echo=FALSE,
               cache = TRUE)
```

## The data: gold-standard preparation

We have pre-cleaned the data and hand-coded it for genre. That is the gold standard. In addition, speech prefixes were retained and systematically set to all-caps. Stage directions were removed. Below is a screenshot of the current version. 

```{r, echo=F, fig.cap="Current version of the text: pre-cleaned and hand-tagged for genre."}
knitr::include_graphics("shrew_markup.png", dpi=190)
```

### Loading the file into R

Reading in the file, the head looks as below.

```{r}
text <- read_docx("shrew_markup.docx") %>% 
  enframe("linenumber", "text")
text  %>% 
  head(10) %>% 
  kbl(caption = "The text as initial R object.") %>% 
  kable_styling(full_width = F, 
                position = "left") 
```

### Current size

The text has been read line-by-line. The current length is `r nrow(text) %>% format(big.mark=" ")` lines. As we process it, we'll find out the number of words.

## Further processing

The following steps should be taken before any analysis can happen.

1. Convert the text to one-word-per-row format. This step typically removes all punctuation and changes upper-case letters to lower-case letters. *We don't want either of these* so I'll set the arguments `to_lower` and `strip_punct` accordingly.
1. Edit those speech prefixes that, like the huntsmen, consist of more than one token.
1. Find all words in all-upper-case spelling -- these are the speech prefixes. Use them to mark each row with the current speaker.
1. Find all instances of *act* or *actus* and use them to identify boundaries between acts. Add a column that states the act for each unit of text.