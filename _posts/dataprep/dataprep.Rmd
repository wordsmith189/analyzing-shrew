---
title: "1 - Data Preparation"
description: |
  Preparation of the pre-cleaned and speaker/genre-tagged play text.
author:
  - name: "Lars Hinrichs"
    url: https://larshinrichs.site
    affiliation: "The University of Texas at Austin"
    affiliation_url: https://liberalarts.utexas.edu/english
date: 10-17-2020
output:
  distill::distill_article:
    self_contained: false
    toc: true
    toc_depth: 3
---

```{r setup}
if (!require(pacman)) install.packages("pacman")
library(pacman)
p_load(rio, tidyverse, tidytext, knitr, flextable,
       kableExtra,
       textreadr, janitor)
opts_chunk$set(echo=FALSE,
               cache = TRUE)
```

## The data: gold-standard preparation

We have pre-cleaned the data and hand-coded it for genre. That is the gold standard. In addition, speech prefixes were retained and systematically set to all-caps. Stage directions were removed. Below is a screenshot of the current version. 

```{r, echo=F, fig.cap="Current version of the text: pre-cleaned and hand-tagged for genre."}
knitr::include_graphics("shrew_markup.png", dpi=190)
```

### Loading the file into R

Reading in the file, the head looks as below.

```{r}
text <- read_docx("shrew_markup.docx") %>% 
  enframe("linenumber", "text")

text  %>% 
  head(10) %>% 
  kbl(caption="The text as initial R object.") %>% 
  kable_styling()
```

### Current size

The text has been read line-by-line. The current length is `r nrow(text) %>% format(big.mark=" ")` lines. As we process it, we'll find out the number of words.

## Further processing

The following items need to happen before any analysis.

1. We'll want to convert the text to one-word-per-row format. This step typically (a) removes all punctuation and (b) changes upper-case to lower-case letters. We **don't really want either** of these, but getting rid of punctution is darn useful. So we will want punctuation removed, but we need to do something to retain the valuable genre-tagging. To address a), then, I'll change our XML format tags (e.g. `<prose>...</prose>`) to lexical tags, i.e. made-up words I can be sure Shakespeare didn't use in the play: `prosestart ... proseend`, `versestart ... verseend`. This will allow me to still remove any punctuation while retaining the genre tagging. 

<aside>Why not? We are relying on capitalization to identify speech prefixes, and on punctuation to identify genre tagging.</aside>

2. Edit those speech prefixes that, like the huntsmen, consist of more than one token.
3. At this point, "tokenize", i.e. change format to one-word-per-row.
4. Identify all words in all-caps spelling -- we know these are the speech prefixes. Use them to mark each row for the current speaker.
5. Identify all genre tags. Use them to mark each row for `prose` or `verse` as genre.
6. Find all instances of *act* or *actus* and use them to identify boundaries between acts. Add a column that states the act for each unit of text.

I'll now work down this list and show the state of the text after each conversion.

#### Change genre tags to lexical tags


#### Edit speech prefixes


#### Tokenize


#### Mark each row for current speaker


#### Mark each row for current genre


#### Mark each row for current act 

